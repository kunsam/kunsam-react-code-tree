{"version":3,"sources":["../webpack/bootstrap","../external \"vscode\"","../external \"path\"","../external \"fs\"",".././src/extensionUtil.ts",".././src/config.ts",".././src/commands/nodeflow/nodeFlowsUtil.ts",".././src/extension.ts",".././src/commands/keybinding.ts",".././src/select/index.ts",".././src/select/bracketUtil.ts",".././src/commands/nodeflow/index.ts",".././src/commands/nodeflow/nodeFlowsView.ts",".././src/type.ts",".././src/commands/router/index.ts",".././src/commands/router/routerTree.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","GotoTextDocument","trueFsPath","vscode","workspace","openTextDocument","then","doc","window","showTextDocument","e","showInformationMessage","filePath","isRelative","fsPath","path","resolve","join","ROOT_PATH","fs","existsSync","statSync","isDirectory","NoneJSIndexes","readdirSync","forEach","f","includes","test","push","length","indexPath","dirName","dirname","basename","files","showQuickPick","map","label","relative","target","placeHolder","result","PROJECT_DIR","workspaceFolders","uri","NodeFlowsUtil","editor","wordRange","document","getWordRangeAtPosition","selection","start","getText","text","findResult","commands","executeCommand","filter","location","range","contains","isEqual","symbol","filePattern","textPattern","element","_element","children","requirePath","dump","useRandom","Math","random","toFixed","element2","elementId","node","originTexts","Array","lineCount","fill","_","lineAt","replace","line","filterArray","a","resultLine","minResults","every","findByFilter","indexOf","context","subscriptions","registerCommand","openToSide","this","init","selectText","getFileAbsolutePath","SearchResult","bracket","offset","findBackward","index","bracketStack","char","charAt","bracketUtil","isQuoteBracket","isOpenBracket","top","pop","isMatch","isCloseBracket","findForward","r1","r2","includeBrack","searchContext","activeTextEditor","selectionStart","offsetAt","anchor","selectionEnd","active","isReversed","backwardStarter","forwardStarter","getSearchContext","msg","backwardResult","forwardResult","end","Selection","positionAt","doSelection","Range","openBarcket","closeBracket","quoteBrackets","open","close","opentIndex","nodeFlowsView","NodeFlowsView","reset","getEditorCursorKReactFlowNode","env","clipboard","writeText","JSON","stringify","showErrorMessage","selectedNode","data","treeDataProvider","topRequirePath","findNodeLine","newSelection","Position","revealRange","nodes","writeFile","refresh","console","log","addChild","CONFIG_FILE_ABS_PATH","_getSymbols","symbols","currentIndex","lastResults","results","Promise","res","handleSearchSymbolResult","promiseRes","filterResult","filterResultsByFilePattern","concat","lastResultsMap","equivalentName","containerName","getBestMatchingSymbol","split","symbolResults","pureText","textPatternLineNumber","textPatternLine","undefined","parseInt","sr","startLine","endLine","count","textIndex","with","_initNodeFlowsView","workflows","_treeDataProvider","KReactCodeTree","cache","_view","createTreeView","showCollapseAll","onDidChangeSelection","_showlocatedDoc","findFiles","file","_showMatchedSymbols","showWarningMessage","rootPath","parent","iconType","KC_NODE_ICON_TYPE","reveal","select","expand","focus","tree","_onDidChangeTreeData","EventEmitter","onDidChangeTreeData","event","ct","_initTree","_tree","truePath","queue","findIndex","isElementEqual","splice","topParent","_getIconPath","collapsibleState","TreeItemCollapsibleState","Collapsed","None","fire","iconPath","light","__filename","dark","KReactCodeTreeItem","TreeItem","version","command","super","contextValue","ROUTER_FILE_ABS_PATH","kRouterTree","KRouterTree","loadRouters","parents","getFileParents","pickFiles2Open","recursiveGetParents","Map","routers","queryFileAppUrl","allRouters","componentRelativePath","queryComponentRelativePathByPath","preventLoopMap","has","set","p_parents","FILE_TREE_MAP","FILE_IMPORTS_MAP","FILE_ROUTERS_MAP","ROUTERS_MAP","KRouterTreeItem","parentId","id","uiNode","_addToTree","absPath","setRelatedFiles","getRelatedFiles","mapImports","imports","item","lineText","texts","relativeImports","nextPath","relatedFiles","parentPath","items","_setFlatternRouters","getFlatternRouters","queryPath","pathname","rpath"],"mappings":"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","file":"extension.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = require(\"vscode\");","module.exports = require(\"path\");","module.exports = require(\"fs\");","\nimport * as fs from 'fs'\nimport * as path from \"path\";\nimport * as vscode from \"vscode\";\nimport { ROOT_PATH } from './config'\n\n/**\n * 获取文件绝对路径\n *\n * @export\n * @param {string} filePath\n * @param {boolean} [isRelative=true]\n * @returns\n */\nexport function getFileAbsolutePath(filePath: string, isRelative = true) {\n\t// 没带后缀\n\tconst fsPath = isRelative ? path.resolve(path.join(ROOT_PATH, filePath)) : filePath;\n\tlet trueFsPath = ''\n\tif (fs.existsSync(fsPath)) {\n\t\tif (fs.statSync(fsPath).isDirectory()) {\n\t\t\tlet NoneJSIndexes = [];\n\t\t\tfs.readdirSync(fsPath).forEach(f => {\n\t\t\t\tif (f.includes('index')) {\n\t\t\t\t\tif (/\\.(jsx?|tsx?)$/g.test(f)) {\n\t\t\t\t\t\ttrueFsPath = path.join(fsPath, f);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tNoneJSIndexes.push(path.join(fsPath, f))\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\tif (!trueFsPath && NoneJSIndexes.length) {\n\t\t\t\tNoneJSIndexes.forEach((indexPath) => {\n\t\t\t\t\tif (/\\.(s?css|less|sass)$/g.test(indexPath)) {\n\t\t\t\t\t\ttrueFsPath = indexPath\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t} else {\n\t\t\ttrueFsPath = fsPath;\n\t\t}\n\t} else {\n\t\t\t// 可能是由没带后缀引起的\n\t\t\tconst dirName = path.dirname(fsPath);\n\t\t\tif (fs.existsSync(dirName)) {\n\t\t\t\tfs.readdirSync(dirName).forEach(f => {\n\t\t\t\t\t// 只判断这两种类型\n\t\t\t\t\tif (/\\.(jsx?|tsx?)$/g.test(f)) {\n\t\t\t\t\t\tif (f.includes(path.basename(fsPath))) {\n\t\t\t\t\t\t\tif (!fs.statSync(path.join(dirName, f)).isDirectory()) {\n\t\t\t\t\t\t\t\ttrueFsPath = path.join(dirName, f);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t}\n\treturn trueFsPath;\n}\n/**\n * vscode打开文件[绝对路径]\n *\n * @export\n * @param {string} trueFsPath\n */\nexport function GotoTextDocument(trueFsPath: string) {\n\tif (!trueFsPath) {\n\t\tvscode.window.showInformationMessage(`未找到结果`)\n\t} else {\n\t\ttry {\n\t\t\tvscode.workspace.openTextDocument(trueFsPath).then((doc) => {\n\t\t\t\tvscode.window.showTextDocument(doc)\n\t\t\t})\n\t\t} catch (e) {\n\t\t\tvscode.window.showInformationMessage(`无法打开${trueFsPath}`)\n\t\t}\n\t}\n}\n\n/**\n * vscode pick 文件列表并打开选中文件 [绝对路径]\n *\n * @export\n * @param {string[]} files\n */\nexport function pickFiles2Open(files: string[]) {\n\tif (files.length === 1) {\n\t\tGotoTextDocument(files[0])\n\t} else {\n\t\tif (files.length > 1) {\n\t\t\tvscode.window.showQuickPick(files.map((r: string) => ({ label: path.relative(ROOT_PATH, r), target: r })), {\n\t\t\t\tplaceHolder: '请选择打开的文件',\n\t\t\t}).then(result => {\n\t\t\t\tif (result && result.target) {\n\t\t\t\t\tGotoTextDocument(result.target)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}","import * as vscode from \"vscode\";\n\n\nexport const PROJECT_DIR = '/__kReactCodeTree__'\n\nexport const ROOT_PATH:  string = vscode.workspace.workspaceFolders[0].uri.path;\n \n","import * as path from 'path'\nimport * as vscode from \"vscode\";\nimport { KC_Node } from '../../type';\n\nexport default class NodeFlowsUtil {\n\n\tstatic getEditorCursorText(editor: vscode.TextEditor) {\n\t\tconst wordRange = editor.document.getWordRangeAtPosition(editor.selection.start)\n\t\tconst text = editor.document.getText(wordRange)\n\t\treturn text;\n\t}\n\n\tstatic async getEditorCursorKReactFlowNode(editor: vscode.TextEditor) {\n\t\tconst wordRange = editor.document.getWordRangeAtPosition(editor.selection.start)\n\t\tif (!wordRange) return;\n\t\tconst text = editor.document.getText(wordRange)\n\t\tif (text) {\n\t\t\tconst findResult = await vscode.commands\n\t\t\t\t.executeCommand(\"vscode.executeDocumentSymbolProvider\", editor.document.uri)\n\t\t\t\t.then((result: vscode.SymbolInformation[]) => {\n\t\t\t\t\tresult = result.filter(r => { return r.location.range.contains(wordRange) })\n\t\t\t\t\tif (result.length === 1) {\n\t\t\t\t\t\treturn result\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\tif (findResult.length === 1) {\n\t\t\t\tif (findResult[0].location.range.isEqual(wordRange)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttext: '节点描述',\n\t\t\t\t\t\tsymbol: findResult[0].name,\n\t\t\t\t\t\tfilePattern: path.relative(vscode.workspace.workspaceFolders[0].uri.path, editor.document.uri.path),\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttext: '节点描述',\n\t\t\t\t\t\tsymbol: findResult[0].name,\n\t\t\t\t\t\tfilePattern: path.relative(vscode.workspace.workspaceFolders[0].uri.path, editor.document.uri.path),\n\t\t\t\t\t\ttextPattern: text,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tpublic static dump(element: KC_Node) {\n\t\tlet _element: any = {\n\t\t\t// _id: NodeFlowsUtil.elementId(element)\n\t\t};\n\t\t[\n\t\t\t'symbol',\n\t\t\t'text',\n\t\t\t'document',\n\t\t\t// 'children',\n\t\t\t'routers',\n\t\t\t'operationKeys',\n\t\t\t'textPattern',\n\t\t\t'filePattern',\n\t\t\t'requirePath'\n\t\t].forEach(key => {\n\t\t\tif (element[key]) {\n\t\t\t\t_element[key] = element[key]\n\t\t\t}\n\t\t})\n\t\tif (element.children && !element.requirePath) {\n\t\t\t_element.children = element.children.map(c => ({\n\t\t\t\t// _id: NodeFlowsUtil.elementId(c),\n\t\t\t\t...NodeFlowsUtil.dump(c)\n\t\t\t}));\n\t\t}\n\t\treturn _element;\n\t}\n\n\tpublic static elementId(element: KC_Node, useRandom = false) {\n\t\treturn `${element.filePattern || ''}-${element.symbol || ''}-${element.textPattern || ''}-${element.text || ''}-${ useRandom ? Math.random().toFixed(6) : ''}`\n\t}\n\n\tpublic static isElementEqual(element: KC_Node, element2: KC_Node) {\n\t\treturn NodeFlowsUtil.elementId(element) === NodeFlowsUtil.elementId(element2)\n\t}\n\n\tpublic static findNodeLine(node: KC_Node, doc: vscode.TextDocument) {\n\t\tconst originTexts = new Array(doc.lineCount - 1).fill(null).map((_, i) => ({ text: doc.lineAt(i + 1).text.replace(/\\\"\\'/g, ''), line: i + 1 }));\n\t\tconst filterArray = [\n\t\t\t'filePattern',\n\t\t\t'text',\n\t\t\t'symbol',\n\t\t\t'document',\n\t\t].filter(a => node[a]);\n\t\tlet resultLine = null;\n\t\tlet minResults = originTexts;\n\t\tfilterArray.every(filter => {\n\t\t\tconst findByFilter = originTexts.filter(t => !!(t.text && t.text.indexOf(node[filter].replace(/\\\"\\'/g, '')) > 0));\n\t\t\tif (findByFilter.length === 1) {\n\t\t\t\tresultLine = findByFilter[0].line\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (minResults.length > findByFilter.length) {\n\t\t\t\tminResults = findByFilter;\n\t\t\t}\n\t\t\treturn resultLine === null\n\t\t})\n\t\tif (resultLine === null && minResults.length && minResults.length !== originTexts.length) {\n\t\t\treturn minResults[0].line;\n\t\t}\n\t\treturn resultLine;\n\t}\n}","\"use strict\";\nimport * as vscode from \"vscode\";\nimport KeybindingCommands from './commands/keybinding';\nimport NodeFlowCommands from './commands/nodeflow';\nimport RoutersCommand from './commands/router';\n\n\n\nexport function activate(context: vscode.ExtensionContext) {\n\n\n  // 在文档右侧打开定义\n  context.subscriptions.push(vscode.commands.registerCommand('extension.addOpenAsideToContextMenu', async () => {\n    await vscode.commands.executeCommand('editor.action.revealDefinitionAside',\n      {\n        openToSide: true\n      });\n  }));\n\n  new NodeFlowCommands(context)\n  new KeybindingCommands(context)\n  new RoutersCommand(context)\n\n\n\n}\n","\n\nimport * as vscode from \"vscode\";\nimport * as path from \"path\";\nimport { selectText } from \"../select\";\nimport { getFileAbsolutePath, GotoTextDocument } from \"../extensionUtil\";\n\nexport default class KeybindingCommands {\n\n\tconstructor(_: vscode.ExtensionContext) {\n\t\tthis.init()\n\t}\n\n\tinit() {\n\t\t// 选中括号/引号内\n\t\tvscode.commands.registerCommand(\"extension.selectBracket\", () => {\n\t\t\tselectText(false);\n\t\t})\n\t\t// 跳转相对路径\n\t\tvscode.commands.registerCommand(\"kReactCodeTree.gotoRelative\", () => {\n\t\t\tconst text = selectText(false)\n\t\t\tconst trueFsPath = getFileAbsolutePath(text)\n\t\t\tGotoTextDocument(trueFsPath)\n\t\t})\n\n\t}\n}","'use strict';\n// The module 'vscode' contains the VS Code extensibility API\n// Import the module and reference it with the alias vscode in your code below\nimport * as vscode from 'vscode';\nimport { bracketUtil } from './bracketUtil';\n\n\n// https://github.com/wangchunsen/vscode-bracket-select/edit/master/src/bracketSelectMain.ts\n\nclass SearchResult {\n    bracket: string;\n    offset: number;\n\n    constructor(bracket: string, offset: number) {\n        this.bracket = bracket;\n        this.offset = offset;\n    }\n}\n\nfunction findBackward(text: string, index: number): SearchResult {\n    const bracketStack: string[] = [];\n    for (let i = index; i >= 0; i--) {\n        let char = text.charAt(i);\n        // if it's a quote, we can not infer it is a open or close one \n        //so just return, this is for the case current selection is inside a string; \n        if (bracketUtil.isQuoteBracket(char) && bracketStack.length == 0) {\n            return new SearchResult(char, i);\n        }\n        if (bracketUtil.isOpenBracket(char)) {\n            if (bracketStack.length == 0) {\n                return new SearchResult(char, i);\n            } else {\n                let top = bracketStack.pop();\n                if (!bracketUtil.isMatch(char, top)) {\n                    throw 'Unmatched bracket pair';\n                }\n            }\n        } else if (bracketUtil.isCloseBracket(char)) {\n            bracketStack.push(char);\n        }\n    }\n    //we are get to edge\n    return null;\n}\n\nfunction findForward(text: string, index: number): SearchResult {\n    const bracketStack: string[] = [];\n    for (let i = index; i < text.length; i++) {\n        let char = text.charAt(i);\n        if (bracketUtil.isQuoteBracket(char) && bracketStack.length == 0) {\n            return new SearchResult(char, i);\n        }\n        if (bracketUtil.isCloseBracket(char)) {\n            if (bracketStack.length == 0) {\n                return new SearchResult(char, i);\n            } else {\n                let top = bracketStack.pop();\n                if (!bracketUtil.isMatch(top, char)) {\n                    throw 'Unmatched bracket pair'\n                }\n            }\n        } else if (bracketUtil.isOpenBracket(char)) {\n            bracketStack.push(char);\n        }\n    }\n    return null;\n}\n\nfunction showInfo(msg: string): void {\n    vscode.window.showInformationMessage(msg);\n}\n\nfunction getSearchContext() {\n    const editor = vscode.window.activeTextEditor;\n    const selection = editor.selection;\n    let selectionStart = editor.document.offsetAt(editor.selection.anchor);\n    let selectionEnd = editor.document.offsetAt(editor.selection.active);\n    if (selection.isReversed) {\n        //exchange\n        [selectionStart, selectionEnd] = [selectionEnd, selectionStart]\n    }\n    return {\n        backwardStarter: selectionStart - 1, //coverage vscode selection index to text index\n        forwardStarter: selectionEnd,\n        text: editor.document.getText()\n    }\n}\n\nfunction doSelection(start: number, end: number) {\n    const editor = vscode.window.activeTextEditor;\n    editor.selection = new vscode.Selection(\n        editor.document.positionAt(start + 1), //convert text index to vs selection index\n        editor.document.positionAt(end));\n}\nfunction isMatch(r1: SearchResult, r2: SearchResult) {\n    return r1 != null && r2 != null && bracketUtil.isMatch(r1.bracket, r2.bracket);\n}\n\nexport function selectText(includeBrack: boolean) {\n    const searchContext = getSearchContext();\n    let { text, backwardStarter, forwardStarter } = searchContext;\n    if (backwardStarter < 0 || forwardStarter >= text.length) {\n        return;\n    }\n\n    let selectionStart: number, selectionEnd: number;\n    var backwardResult = findBackward(searchContext.text, searchContext.backwardStarter);\n    var forwardResult = findForward(searchContext.text, searchContext.forwardStarter);\n\n    while (forwardResult != null\n        && !isMatch(backwardResult, forwardResult)\n        && bracketUtil.isQuoteBracket(forwardResult.bracket)) {\n        forwardResult = findForward(searchContext.text, forwardResult.offset + 1);\n    }\n    while (backwardResult != null\n        && !isMatch(backwardResult, forwardResult)\n        && bracketUtil.isQuoteBracket(backwardResult.bracket)) {\n        backwardResult = findBackward(searchContext.text, backwardResult.offset - 1);\n    }\n\n    if (!isMatch(backwardResult, forwardResult)) {\n        showInfo('Unmatched bracket pair')\n        return;\n    }\n    // we are next to a bracket\n    // this is the case for doule press select\n    if (backwardStarter == backwardResult.offset && forwardResult.offset == forwardStarter) {\n        selectionStart = backwardStarter - 1;\n        selectionEnd = forwardStarter + 1;\n    } else {\n        if (includeBrack) {\n            selectionStart = backwardResult.offset - 1;\n            selectionEnd = forwardResult.offset + 1;\n        } else {\n            selectionStart = backwardResult.offset;\n            selectionEnd = forwardResult.offset;\n        }\n    }\n        doSelection(selectionStart, selectionEnd);\n        \n        const editor = vscode.window.activeTextEditor;\n        return editor.document.getText(\n            new vscode.Range(\n                editor.document.positionAt(selectionStart + 1),\n                editor.document.positionAt(selectionEnd)\n            )\n        )\n}\n\n\n// //This is the main extension point\n// export function activate(context: vscode.ExtensionContext) {\n//     context.subscriptions.push(\n//         vscode.commands.registerCommand('bracket-select.select', function () {\n//             selectText(false);\n//         }),\n//         vscode.commands.registerCommand('bracket-select.select-include', function () {\n//             selectText(true);\n//         })\n//     );\n// }\n\n// // this method is called when your extension is deactivated\n// export function deactivate() {\n// }","// https://github.com/wangchunsen/vscode-bracket-select/edit/master/src/bracketSelectMain.ts\n\n'use strict';\n\nexport namespace bracketUtil {\n    let openBarcket = ['(', '{', '[']\n    let closeBracket = [')', '}', ']']\n    let quoteBrackets = ['\"', \"'\"]\n\n    export function isMatch(open: string, close: string): Boolean {\n        let opentIndex = openBarcket.indexOf(open)\n        if (opentIndex >= 0) {\n            return closeBracket[opentIndex] == close;\n        } else if (isQuoteBracket(open)) {\n            return open == close;\n        }\n        return false;\n    }\n\n    export function isOpenBracket(char: string): Boolean {\n        return openBarcket.indexOf(char) >= 0;\n    }\n\n    export function isCloseBracket(char: string): Boolean {\n        return closeBracket.indexOf(char) >= 0;\n    }\n\n    export function isQuoteBracket(char: string): Boolean {\n        return quoteBrackets.indexOf(char) >= 0;\n    }\n}","\nimport * as fs from 'fs'\nimport * as vscode from \"vscode\";\nimport { KC_Node } from \"../../type\";\nimport NodeFlowsUtil from \"./nodeFlowsUtil\";\nimport { NodeFlowsView } from \"./nodeFlowsView\";\n\n\n\nexport default class NodeFlowCommands {\n\n\tconstructor(context: vscode.ExtensionContext) {\n\t\tthis.init(context)\n\t}\n\n\tinit(context) {\n\t\tconst nodeFlowsView = new NodeFlowsView();\n\t\tvscode.commands.registerCommand(\"kReactCodeTree.refresh\", () => {\n\t\t\tvscode.window.showInformationMessage(`kReactCodeTree called refresh.`);\n\t\t\tnodeFlowsView.reset();\n\t\t});\n\n\t\t// 需要左边 kReactCodeTree 面板打开才执行\n\t\tcontext.subscriptions.push(vscode.commands.registerCommand(\n\t\t\t\"extension.getKReactNodeCode\",\n\t\t\tasync () => {\n\t\t\t\tconst editor = vscode.window.activeTextEditor;\n\t\t\t\tconst node = await NodeFlowsUtil.getEditorCursorKReactFlowNode(editor)\n\t\t\t\tif (node) {\n\t\t\t\t\tvscode.env.clipboard.writeText(JSON.stringify({ ...node, filePattern: node.filePattern }, null, 2))\n\t\t\t\t\tvscode.window.showInformationMessage(`Successfully wrote into clipboard.`)\n\t\t\t\t} else {\n\t\t\t\t\tvscode.window.showErrorMessage(`Get KReact Node Code failed`)\n\t\t\t\t}\n\t\t\t}\n\t\t));\n\n\t\t// kReactCodeTree.editNode\n\t\tcontext.subscriptions.push(vscode.commands.registerCommand(\"kReactCodeTree.editNode\", async (selectedNode: KC_Node) => {\n\t\t\tif (!selectedNode) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst data = nodeFlowsView.treeDataProvider.topRequirePath(selectedNode);\n\t\t\tvscode.workspace.openTextDocument(data.requirePath).then(doc => {\n\t\t\t\tvscode.window.showTextDocument(doc).then(editor => {\n\t\t\t\t\tconst line = NodeFlowsUtil.findNodeLine(selectedNode, doc);\n\t\t\t\t\tif (line !== null) {\n\t\t\t\t\t\tvar newSelection = new vscode.Selection(new vscode.Position(line, 0), new vscode.Position(line, 0));\n\t\t\t\t\t\teditor.selection = newSelection;\n\t\t\t\t\t\teditor.revealRange(new vscode.Range(newSelection.anchor, newSelection.active))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t}));\n\n\t\tcontext.subscriptions.push(vscode.commands.registerCommand(\"kReactCodeTree.insertIn\", async (selectedNode: KC_Node) => {\n\t\t\tconst editor = vscode.window.activeTextEditor;\n\t\t\tconst node = await NodeFlowsUtil.getEditorCursorKReactFlowNode(editor)\n\t\t\tif (!selectedNode) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (!node) {\n\t\t\t\tvscode.window.showInformationMessage(`当前光标位置无效，请在文档中选择一个位置`)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!selectedNode.children) {\n\t\t\t\tselectedNode.children = []\n\t\t\t}\n\t\t\tselectedNode.children.push(node)\n\t\t\tconst data = nodeFlowsView.treeDataProvider.topRequirePath(selectedNode);\n\t\t\ttry {\n\t\t\t\tlet text = `\\nmodule.exports = ${JSON.stringify(data.nodes.map(n => NodeFlowsUtil.dump(n)), null, 2)}`\n\t\t\t\tfs.writeFile(data.requirePath, text, () => {\n\t\t\t\t\tnodeFlowsView.refresh()\n\t\t\t\t\tvscode.window.showInformationMessage('更新成功')\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e, 'errrrr')\n\t\t\t}\n\t\t}));\n\n\t\tcontext.subscriptions.push(vscode.commands.registerCommand(\"kReactCodeTree.insertAfter\", async (selectedNode: KC_Node) => {\n\t\t\tconst editor = vscode.window.activeTextEditor;\n\t\t\tconst node = await NodeFlowsUtil.getEditorCursorKReactFlowNode(editor)\n\t\t\tif (!selectedNode) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (!node) {\n\t\t\t\tvscode.window.showInformationMessage(`当前光标位置无效，请在文档中选择一个位置`)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnodeFlowsView.treeDataProvider.addChild(node, selectedNode);\n\t\t\tconst data = nodeFlowsView.treeDataProvider.topRequirePath(selectedNode);\n\t\t\ttry {\n\t\t\t\tlet text = `\\nmodule.exports = ${JSON.stringify(data.nodes.map(n => NodeFlowsUtil.dump(n)), null, 2)}`\n\t\t\t\tfs.writeFile(data.requirePath, text, () => {\n\t\t\t\t\tnodeFlowsView.refresh()\n\t\t\t\t\tvscode.window.showInformationMessage('更新成功')\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e, 'errrrr')\n\t\t\t}\n\n\t\t}));\n\t}\n\n}","import * as fs from \"fs\";\nimport * as path from 'path'\nimport * as vscode from \"vscode\";\nimport NodeFlowsUtil from \"./nodeFlowsUtil\";\nimport { KC_Node, KC_NODE_ICON_TYPE } from \"../../type\";\nimport { ROOT_PATH, PROJECT_DIR } from \"../../config\";\n\nconst CONFIG_FILE_ABS_PATH = path.join(ROOT_PATH, PROJECT_DIR, '/workflows/index.js')\n\n\nfunction _getSymbols(\n\tdata: KC_Node,\n\tsymbols: string[],\n\tcurrentIndex: number,\n\tlastResults: vscode.SymbolInformation[],\n\tresults: vscode.SymbolInformation[],\n\tdoc?: vscode.TextDocument\n): Promise<vscode.SymbolInformation[]> {\n\n\treturn new Promise((res) => {\n\n\t\tfunction filterResultsByFilePattern(symbols: vscode.SymbolInformation[]) {\n\t\t\treturn (data.filePattern && symbols.filter(r => r.location.uri.path.includes(data.filePattern))) || symbols;\n\t\t}\n\n\t\tfunction handleSearchSymbolResult(result: vscode.SymbolInformation[]): Promise<vscode.SymbolInformation[]> {\n\t\t\treturn new Promise(promiseRes => {\n\t\t\t\tlet filterResult = filterResultsByFilePattern(result).filter(r => {\n\t\t\t\t\t// 过滤掉相关符号\n\t\t\t\t\tconst equivalentName = r.name.replace(/\\(|\\)|\\{|\\}|\\[|\\]/g, '')\n\t\t\t\t\t// console.log(r.name, equivalentName, symbols[currentIndex], 'equivalentNameequivalentName')\n\t\t\t\t\treturn equivalentName === symbols[currentIndex];\n\t\t\t\t})\n\t\t\t\tif (symbols[currentIndex + 1]) {\n\t\t\t\t\t_getSymbols(data, symbols, currentIndex + 1, filterResult, results).then(d => promiseRes(d));\n\t\t\t\t} else {\n\t\t\t\t\tresults = results.concat(filterResult);\n\t\t\t\t\tpromiseRes(results);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tif (currentIndex === 0) {\n\t\t\t// executeDocumentSymbolProvider not work\n\t\t\tvscode.commands\n\t\t\t\t.executeCommand(\"vscode.executeWorkspaceSymbolProvider\", symbols[currentIndex])\n\t\t\t\t.then((result: vscode.SymbolInformation[]) => {\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\t// 筛选filePattern指定的文件来源\n\t\t\t\t\t\tresult = result.filter(r => r.location.uri.path === doc.uri.path);\n\t\t\t\t\t}\n\t\t\t\t\thandleSearchSymbolResult(result).then(r => res(r));\n\t\t\t\t})\n\t\t\treturn;\n\t\t} else {\n\t\t\tconst lastResultsMap = {}\n\t\t\tlastResults.forEach(s => {\n\t\t\t\tif (s.name) {\n\t\t\t\t\tconst equivalentName = s.name.replace(/\\(|\\)|\\{|\\}|\\[|\\]/g, '')\n\t\t\t\t\tlastResultsMap[equivalentName] = true\n\t\t\t\t}\n\t\t\t})\n\t\t\tlastResults.forEach(() => {\n\t\t\t\tvscode.commands\n\t\t\t\t\t.executeCommand(\"vscode.executeWorkspaceSymbolProvider\", symbols[currentIndex])\n\t\t\t\t\t.then((result: vscode.SymbolInformation[]) => {\n\t\t\t\t\t\t// console.log(currentIndex, lastResultsMap, result, 'lastResultsMap executeWorkspaceSymbolProvider')\n\t\t\t\t\t\thandleSearchSymbolResult(result.filter(r => lastResultsMap[r.containerName])).then(r => res(r));\n\t\t\t\t\t})\n\t\t\t})\n\t\t\treturn;\n\t\t}\n\t})\n\n}\n\nfunction getBestMatchingSymbol(data: KC_Node, doc?: vscode.TextDocument): Thenable<vscode.SymbolInformation[]> {\n\t// let onlyResult: vscode.SymbolInformation | undefined = undefined;\n\treturn new Promise((res) => {\n\t\tif (!data.symbol) {\n\t\t\tres([])\n\t\t\treturn;\n\t\t}\n\t\tif (data.symbol) {\n\t\t\tconst symbols = data.symbol.split(\".\");\n\t\t\t_getSymbols(data, symbols, 0, [], [], doc).then(symbolResults => {\n\t\t\t\t// console.log(symbolResults, '_getSymbols results')\n\t\t\t\t// 打开多个吧\n\t\t\t\tif (data.textPattern) {\n\t\t\t\t\tconst pureText = data.textPattern.split('#')[0];\n\t\t\t\t\tconst textPatternLineNumber = data.textPattern.split('#')[1]\n\t\t\t\t\tconst textPatternLine = textPatternLineNumber !== undefined ? parseInt(textPatternLineNumber) : 1;\n\t\t\t\t\tsymbolResults = symbolResults.filter(async (sr) => {\n\t\t\t\t\t\tconst doc = await vscode.workspace.openTextDocument(sr.location.uri)\n\t\t\t\t\t\tconst startLine = sr.location.range.start.line;\n\t\t\t\t\t\tconst endLine = sr.location.range.end.line;\n\t\t\t\t\t\tlet count = 1;\n\t\t\t\t\t\tfor (let i = startLine; i <= endLine; i++) {\n\t\t\t\t\t\t\tconst text = doc.lineAt(i).text;\n\t\t\t\t\t\t\tconst textIndex = text.indexOf(pureText);\n\t\t\t\t\t\t\tif (textIndex >= 0) {\n\t\t\t\t\t\t\t\tif (count === textPatternLine) {\n\t\t\t\t\t\t\t\t\tsr.location.range = sr.location.range.with(new vscode.Position(i, textIndex), new vscode.Position(i, textIndex + text.length))\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t\t// console.log(data.textPattern, symbolResults, 'data.textPattern symbolResults')\n\t\t\t\t}\n\t\t\t\tres(symbolResults)\n\t\t\t})\n\t\t}\n\n\t})\n\n}\n\n\n\n\n\nexport class NodeFlowsView {\n\tprivate _view: vscode.TreeView<KC_Node>;\n\tprivate _treeDataProvider: KReactCodeTree;\n\n\tconstructor() {\n\n\t\tthis._initNodeFlowsView();\n\t}\n\n\tprivate async _initNodeFlowsView() {\n\n\t\tif (fs.existsSync(CONFIG_FILE_ABS_PATH)) {\n\t\t\tconst workflows = __non_webpack_require__(`${CONFIG_FILE_ABS_PATH}`)\n\t\t\tthis._treeDataProvider = new KReactCodeTree(workflows)\n\t\t\tdelete __non_webpack_require__.cache[__non_webpack_require__.resolve(`${CONFIG_FILE_ABS_PATH}`)]\n\t\t\tthis._view = vscode.window.createTreeView(\"kReactCodeTree\", {\n\t\t\t\ttreeDataProvider: this._treeDataProvider,\n\t\t\t\tshowCollapseAll: true\n\t\t\t});\n\t\t\tthis._view.onDidChangeSelection(e => {\n\t\t\t\te.selection.forEach(data => {\n\t\t\t\t\tif (data.children && data.children.length) return;\n\t\t\t\t\tconsole.log(data, \"onDidChangeSelection selection\");\n\n\t\t\t\t\tif (data.location) {\n\t\t\t\t\t\tthis._showlocatedDoc(data.location);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// todo 存在Location直接跳转\n\n\t\t\t\t\t// 如果有filePattern 先加载这个fileDocument\n\t\t\t\t\tif (data.filePattern) {\n\t\t\t\t\t\tvscode.workspace.findFiles(data.filePattern).then(files => {\n\t\t\t\t\t\t\tconsole.log(files, \"findFiles\");\n\t\t\t\t\t\t\tif (files.length > 1) {\n\t\t\t\t\t\t\t\tvscode.window.showInformationMessage(`filePattern对应了多个文件，请确定唯一性`)\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!files.length) {\n\t\t\t\t\t\t\t\tvscode.window.showErrorMessage(`未找到filePattern对应文件 ${data.filePattern}`)\n\t\t\t\t\t\t\t\tgetBestMatchingSymbol(data).then((results => {\n\t\t\t\t\t\t\t\t\tthis._showMatchedSymbols(data, results, ROOT_PATH)\n\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst file = files[0];\n\t\t\t\t\t\t\t\tvscode.workspace.openTextDocument(file).then(doc => {\n\t\t\t\t\t\t\t\t\tgetBestMatchingSymbol(data, doc).then((results => {\n\t\t\t\t\t\t\t\t\t\t// 仅有 filepattern结果\n\t\t\t\t\t\t\t\t\t\tif (!results.length) {\n\t\t\t\t\t\t\t\t\t\t\tvscode.window.showTextDocument(doc)\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tthis._showMatchedSymbols(data, results, ROOT_PATH)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgetBestMatchingSymbol(data).then((results => {\n\t\t\t\t\t\t\tthis._showMatchedSymbols(data, results, ROOT_PATH)\n\t\t\t\t\t\t}))\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tvscode.window.showWarningMessage(`plz add ${CONFIG_FILE_ABS_PATH}`)\n\t\t}\n\n\t}\n\n\tpublic get treeDataProvider() {\n\t\treturn this._treeDataProvider;\n\t}\n\tpublic refresh() {\n\t\tthis._treeDataProvider.refresh();\n\t}\n\n\tpublic reset() {\n\t\tthis._initNodeFlowsView()\n\t}\n\n\tprivate _showlocatedDoc(location: vscode.Location) {\n\t\tvscode.workspace.openTextDocument(location.uri).then(doc => {\n\t\t\tvscode.window.showTextDocument(doc).then(editor => {\n\t\t\t\teditor.revealRange(location.range);\n\t\t\t\t// var newPosition = position.with(position.line, 0);\n\t\t\t\tvar newSelection = new vscode.Selection(location.range.start, location.range.end);\n\t\t\t\teditor.selection = newSelection;\n\t\t\t})\n\t\t})\n\t}\n\n\t// 用一种封装的Node\n\tprivate _showMatchedSymbols(data: KC_Node, symbolResults: vscode.SymbolInformation[], rootPath: string) {\n\t\t// 更新节点\n\t\tif (!data.children) data.children = [];\n\t\tsymbolResults.forEach(sr => {\n\t\t\t// 暂时没封装 addChild\n\t\t\tdata.children.push({\n\t\t\t\ttext: `${sr.name} - ${path.relative(rootPath, sr.location.uri.path)}`,\n\t\t\t\tlocation: sr.location,\n\t\t\t\tparent: data,\n\t\t\t\ticonType: KC_NODE_ICON_TYPE.result\n\t\t\t})\n\t\t})\n\t\tthis._treeDataProvider.refresh();\n\t\tthis._view.reveal(data.children[0], { select: false, expand: true, focus: true })\n\t\tif (symbolResults.length === 1) {\n\t\t\tthis._showlocatedDoc(symbolResults[0].location)\n\t\t}\n\t}\n}\n\n\n\nexport class KReactCodeTree implements vscode.TreeDataProvider<KC_Node> {\n\tprivate _tree: KC_Node[];\n\tprivate _onDidChangeTreeData: vscode.EventEmitter<KC_Node | undefined> = new vscode.EventEmitter<KC_Node | undefined>();\n\treadonly onDidChangeTreeData: vscode.Event<KC_Node | undefined> = this._onDidChangeTreeData.event;\n\n\tconstructor(tree: KC_Node[]) {\n\t\ttree.forEach(ct => {\n\t\t\tthis._initTree(ct);\n\t\t})\n\t\tthis._tree = tree;\n\t}\n\tprivate _initTree(element: KC_Node) {\n\n\t\tif (!element.iconType) {\n\t\t\tif (element.children && element.children.length) {\n\t\t\t\telement.iconType = KC_NODE_ICON_TYPE.node;\n\t\t\t} else {\n\t\t\t\tif (element.symbol) {\n\t\t\t\t\telement.iconType = KC_NODE_ICON_TYPE.node;\n\t\t\t\t} else {\n\t\t\t\t\tif (element.filePattern) {\n\t\t\t\t\t\telement.iconType = KC_NODE_ICON_TYPE.file;\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.iconType = KC_NODE_ICON_TYPE.text;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (element.requirePath) {\n\t\t\t// __kReactCodeTree__/workflows\n\t\t\tconst truePath = path.join(ROOT_PATH, PROJECT_DIR, '/workflows', element.requirePath)\n\t\t\ttry {\n\t\t\t\telement.children = __non_webpack_require__(`${truePath}`)\n\t\t\t\tdelete __non_webpack_require__.cache[__non_webpack_require__.resolve(`${truePath}`)]\n\t\t\t} catch {\n\t\t\t\tvscode.window.showErrorMessage(`${truePath}有误`)\n\t\t\t}\n\t\t}\n\t\tif (element.children && element.children.length) {\n\t\t\telement.children.forEach(c => {\n\t\t\t\tc.parent = element;\n\t\t\t\tthis._initTree(c);\n\t\t\t})\n\t\t}\n\t}\n\n\tpublic addChild(element: KC_Node, selectedNode?: KC_Node) {\n\t\tlet queue = this._tree;\n\t\tif (selectedNode.parent) {\n\t\t\tif (!selectedNode.parent.children) {\n\t\t\t\tselectedNode.parent.children = []\n\t\t\t}\n\t\t\tqueue = selectedNode.parent.children\n\t\t}\n\t\tconst findIndex = queue.findIndex(c => NodeFlowsUtil.isElementEqual(c, selectedNode));\n\t\tif (findIndex >= 0) {\n\t\t\tqueue.splice(findIndex + 1, 0, element)\n\t\t} else {\n\t\t\tqueue.push(element)\n\t\t}\n\t}\n\tpublic topRequirePath(element: KC_Node) {\n\t\tlet topParent = element;\n\t\tif (!element.parent) {\n\t\t\treturn {\n\t\t\t\tnodes: this._tree,\n\t\t\t\trequirePath: CONFIG_FILE_ABS_PATH\n\t\t\t}\n\t\t}\n\t\twhile (topParent.parent && !topParent.requirePath) {\n\t\t\ttopParent = topParent.parent\n\t\t}\n\t\tif (!topParent.parent && topParent.requirePath) {\n\t\t\treturn {\n\t\t\t\tnodes: topParent.children,\n\t\t\t\trequirePath: topParent.requirePath\n\t\t\t}\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tnodes: this._tree,\n\t\t\t\trequirePath: CONFIG_FILE_ABS_PATH\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic getChildren(element: KC_Node) {\n\t\tif (!element) return this._tree;\n\t\treturn element.children || [];\n\t}\n\tpublic getTreeItem(element: KC_Node): vscode.TreeItem {\n\n\t\treturn {\n\t\t\tlabel: element.text,\n\t\t\t// tooltip: '1',\n\t\t\t...this._getIconPath(element.children && element.children.length ? KC_NODE_ICON_TYPE.node : element.iconType),\n\t\t\tcollapsibleState: element.children && element.children.length ? vscode.TreeItemCollapsibleState.Collapsed : vscode.TreeItemCollapsibleState.None\n\t\t};\n\t}\n\tpublic getParent(element: KC_Node) {\n\t\treturn element.parent;\n\t}\n\tpublic refresh() {\n\t\tthis._onDidChangeTreeData.fire();\n\t}\n\tprivate _getIconPath(iconType?: KC_NODE_ICON_TYPE) {\n\t\tswitch (iconType) {\n\t\t\tdefault: {\n\t\t\t\treturn {}\n\t\t\t}\n\t\t\tcase KC_NODE_ICON_TYPE.node: {\n\t\t\t\treturn {\n\t\t\t\t\ticonPath: {\n\t\t\t\t\t\tlight: `${path.join(__filename, '..', '..', 'resources', 'light', 'node.svg')}`,\n\t\t\t\t\t\tdark: `${path.join(__filename, '..', '..', 'resources', 'dark', 'node.svg')}`,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase KC_NODE_ICON_TYPE.text: {\n\t\t\t\treturn {\n\t\t\t\t\ticonPath: {\n\t\t\t\t\t\tlight: `${path.join(__filename, '..', '..', 'resources', 'light', 'text.svg')}`,\n\t\t\t\t\t\tdark: `${path.join(__filename, '..', '..', 'resources', 'dark', 'text.svg')}`,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase KC_NODE_ICON_TYPE.result: {\n\t\t\t\treturn {\n\t\t\t\t\ticonPath: {\n\t\t\t\t\t\tlight: path.join(__filename, '..', '..', 'resources', 'light', 'gou.svg'),\n\t\t\t\t\t\tdark: path.join(__filename, '..', '..', 'resources', 'dark', 'gou.svg'),\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase KC_NODE_ICON_TYPE.file: {\n\t\t\t\treturn {\n\t\t\t\t\ticonPath: {\n\t\t\t\t\t\tlight: path.join(__filename, '..', '..', 'resources', 'light', 'document.svg'),\n\t\t\t\t\t\tdark: path.join(__filename, '..', '..', 'resources', 'dark', 'document.svg'),\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nexport class KReactCodeTreeItem extends vscode.TreeItem {\n\n\tconstructor(\n\t\tpublic readonly label: string,\n\t\tprivate version: string,\n\t\tpublic readonly collapsibleState: vscode.TreeItemCollapsibleState,\n\t\tpublic readonly command?: vscode.Command\n\t) {\n\t\tsuper(label, collapsibleState);\n\t}\n\n\tget tooltip(): string {\n\t\treturn `${this.label}-${this.version}`;\n\t}\n\n\tget description(): string {\n\t\treturn this.version;\n\t}\n\n\ticonPath = {\n\t\tlight: path.join(__filename, '..', '..', 'resources', 'light', 'dependency.svg'),\n\t\tdark: path.join(__filename, '..', '..', 'resources', 'dark', 'dependency.svg')\n\t};\n\n\tcontextValue = 'dependency';\n\n}","import * as vscode from 'vscode';\n\nexport type KC_RouterInfo = {\n\tpathname: string;\n\tquery: {\n\t\tkey?: string;\n\t}\n}\n\n\n\n// 先指定 filePattern\n// 然后寻找 symbol 查找节点必须存在，不存在未纯文字展示类型\n// a.b.c 分步查找 symbol\n// 根据 textPattern 过滤 查找结果\n// 将结果写入node 子节点中并展开\n// 点击子节点跳转到对应文档位置\n\nexport enum KC_NODE_ICON_TYPE {\n\ttext = 'text',\n\tnode = 'node',\n\tresult = 'result',\n\tfile = 'file'\n}\n\nexport type KC_Node = {\n\n\t// 如果全局存在多个symbol最好指定 文件 filePattern\n\tsymbol?: string // 没有symbol 仅显示文字，点击没用    react项目中可能symbol 会相同\n\t// 多次出现以第一个为准\n\ttext: string\n\n\n\n\tdocument?: string\n\tchildren?: KC_Node[]\n\n\trouters?: string[] // 对应的路由列表\n\toperationKeys?: string // 会做一个操作表  在其他地方如谷歌拓展程序里查找对应的操作流，根据操作流执行，定位到具体的UI页面/组件\n\n\t// 本来想用 symbol + line 的方式定位调用处的，但是想着line经常会变动，还是不要用这种方式了\n\t// line?: number // symbol + line 方式定位\n\t// TODO 到时候增加一个右键菜单，获取相对路径，用于在chrome打断点调试 以查看调用栈\n\n\ttextPattern?: string // symbol + textPattern 模式找到调用处的位置，textPattern 可能会存在多个，#指定第几个\n\tfilePattern?: string // 唯一指定\n\n\t// 直接点位\n\tlocation?: vscode.Location\n\tparent?: KC_Node;\n\n\ticonType?: KC_NODE_ICON_TYPE\n\trequirePath?: string // 如果存在，这个是相对路径(__kReactCodeTree__/workflows/index.js) 使用 requirePath 加载children\n\t_id?: string // 自动化生成后反向查找\n}\n\n\n\nexport type SceneWorkflows = {\n\ttitle: string;\n\tlist: KC_Node[]\n}","\nimport * as fs from 'fs'\nimport * as path from 'path'\nimport * as vscode from \"vscode\";\nimport { ROOT_PATH, PROJECT_DIR } from '../../config'\nimport { KRouterTree, KRouter } from './routerTree';\nimport { pickFiles2Open, getFileAbsolutePath, GotoTextDocument } from '../../extensionUtil';\n\nexport default class RoutersCommand {\n\n\tpublic kRouterTree: KRouterTree;\n\n\tconstructor(context: vscode.ExtensionContext) {\n\t\tthis.init(context)\n\t}\n\n\tloadRouters() {\n\t\tconst ROUTER_FILE_ABS_PATH = path.join(ROOT_PATH, PROJECT_DIR, '/router_config.js')\n\t\tif (!fs.existsSync(ROUTER_FILE_ABS_PATH)) {\n\t\t\tvscode.window.showErrorMessage('未找到路由配置文件')\n\t\t\treturn\n\t\t}\n\t\treturn __non_webpack_require__(`${ROUTER_FILE_ABS_PATH}`);\n\t}\n\n\tinit(context: vscode.ExtensionContext) {\n\n\t\tthis.kRouterTree = new KRouterTree(this.loadRouters())\n\n\t\t// 右键菜单 goFileParentFile\n\t\tcontext.subscriptions.push(vscode.commands.registerCommand(\"extension.goFileParentFile\", (uri: vscode.Uri) => {\n\t\t\tconst parents = this.kRouterTree.getFileParents(uri.fsPath)\n\t\t\tpickFiles2Open(parents)\n\t\t}))\n\t\t// 右键菜单 goFileTopParentFile\n\t\tcontext.subscriptions.push(vscode.commands.registerCommand(\"extension.goFileTopParentFile\", (uri: vscode.Uri) => {\n\t\t\tlet parents = this.recursiveGetParents(uri.fsPath, [], new Map())\n\t\t\tpickFiles2Open(parents)\n\t\t}))\n\t\t// 右键菜单 getFileAppUrl\n\t\tcontext.subscriptions.push(vscode.commands.registerCommand(\"extension.getFileAppUrl\", (uri: vscode.Uri) => {\n\t\t\tconst routers = this.kRouterTree.queryFileAppUrl(uri.fsPath)\n\t\t\tif (routers) {\n\t\t\t\t// TODO 增加一个端口配置\n\t\t\t\tvscode.env.clipboard.writeText(routers.map(r => 'https://localhost:3000' + r).join('\\n'));\n\t\t\t\tvscode.window.showInformationMessage('复制成功')\n\t\t\t} else {\n\t\t\t\tvscode.window.showInformationMessage('暂无结果')\n\t\t\t}\n\t\t}))\n\n\t\t// 快捷键搜索\n\t\tcontext.subscriptions.push(vscode.commands.registerCommand('kReactRouterTree.SearchRouter', async () => {\n\t\t\tconst result: any = await vscode.window.showQuickPick(this.kRouterTree.allRouters.map((r: KRouter) => ({ label: r.path })), {\n\t\t\t\tplaceHolder: '请输入 pathname',\n\t\t\t});\n\t\t\tif (result && result.label) {\n\t\t\t\tconst componentRelativePath = this.kRouterTree.queryComponentRelativePathByPath(result.label)\n\t\t\t\tif (componentRelativePath) {\n\t\t\t\t\tconst filePath = getFileAbsolutePath(componentRelativePath)\n\t\t\t\t\tGotoTextDocument(filePath)\n\t\t\t\t}\n\t\t\t}\n\t\t}))\n\t}\n\n\trecursiveGetParents(path: string, result: string[], preventLoopMap: Map<string, boolean>) {\n\t\tif (preventLoopMap.has(path)) {\n\t\t\treturn result;\n\t\t}\n\t\tpreventLoopMap.set(path, true);\n\t\tlet parents = this.kRouterTree.getFileParents(path).filter((a: string) => a !== path)\n\t\tif (parents) {\n\t\t\tparents.forEach((p: string) => {\n\t\t\t\tconst p_parents = this.kRouterTree.getFileParents(p)\n\t\t\t\tif (!(p_parents && p_parents.length)) {\n\t\t\t\t\tresult.push(p)\n\t\t\t\t} else {\n\t\t\t\t\tthis.recursiveGetParents(p, result, preventLoopMap)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn result;\n\t}\n\n\n}","import * as path from 'path'\n\nimport * as vscode from \"vscode\";\nimport { getFileAbsolutePath } from '../../extensionUtil';\n\n\nexport type PathComponentPathPair = {\n\tpath: string\n\tcomponentRelativePath: string\n}\n\n\n// 文件 - 子节点表\nconst FILE_TREE_MAP: Map<string, string[]> = new Map();\n\n// 文件 - 引入表\nconst FILE_IMPORTS_MAP: Map<string, string[]> = new Map();\n\n// 文件 - 路由表\nconst FILE_ROUTERS_MAP: Map<string, string[]> = new Map();\n\n// 路由表\nconst ROUTERS_MAP: Map<string, PathComponentPathPair> = new Map();\n\n\nexport type KRouter = {\n\tpath?: string\n\tuiNode?: boolean\n\trouters?: KRouter[]\n\tIndexRoute?: boolean\n\tcomponentRelativePath: string\n}\n\n\n\nasync function getRelatedFiles(id: string, absPath: string) {\n\tif (!id || !absPath) {\n\t\treturn;\n\t}\n\tconst mapImports = FILE_IMPORTS_MAP.get(absPath);\n\tconst imports = mapImports || [];\n\tif (mapImports) {\n\t\tKRouterTreeItem.setRelatedFiles(id, mapImports)\n\t\tmapImports.forEach(item => {\n\t\t\tgetRelatedFiles(id, item)\n\t\t})\n\t} else {\n\t\ttry {\n\t\t\tconst doc = await vscode.workspace.openTextDocument(getFileAbsolutePath(absPath, false))\n\t\t\tfor (let i = 1; i < doc.lineCount - 1; i++) {\n\t\t\t\tconst lineText = doc.lineAt(i).text;\n\t\t\t\tif (/\\sfrom\\s\\'/.test(lineText)) {\n\t\t\t\t\tconst texts = lineText.split(' ')\n\t\t\t\t\tif (texts[texts.length - 1]) {\n\t\t\t\t\t\tconst item = texts[texts.length - 1].replace('\\'', '').replace('\\\"', '');\n\t\t\t\t\t\titem && imports.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (/import\\(\\'/.test(lineText)) {\n\t\t\t\t\tconst texts = lineText.split('\\'')\n\t\t\t\t\tif (texts[1]) {\n\t\t\t\t\t\tconst item = texts[1].replace('\\'', '').replace('\\\"', '');\n\t\t\t\t\t\titem && imports.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (/function(.+)/.test(lineText) || /export(.+)/.test(lineText)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst relativeImports = imports.filter(i => i.includes('/')).map(a => a.replace(/\\'/g, '').replace(/\\\"/g, '')).map(item => {\n\t\t\t\tif (/^\\.+/.test(item)) {\n\t\t\t\t\treturn path.join(path.dirname(absPath), item)\n\t\t\t\t}\n\t\t\t\tif (/src\\//.test(item)) {\n\t\t\t\t\treturn getFileAbsolutePath(item)\n\t\t\t\t}\n\t\t\t\treturn undefined\n\t\t\t}).filter(a => !!a);\n\t\t\trelativeImports.forEach(nextPath => {\n\t\t\t\tif (!FILE_ROUTERS_MAP.has(nextPath)) {\n\t\t\t\t\tgetRelatedFiles(id, nextPath)\n\t\t\t\t}\n\t\t\t})\n\t\t\tFILE_IMPORTS_MAP.set(absPath, relativeImports)\n\t\t\tKRouterTreeItem.setRelatedFiles(id, relativeImports, absPath)\n\t\t} catch {\n\n\t\t}\n\t}\n}\n\n\nexport class KRouterTreeItem {\n\tpublic id: string;\n\tpublic path: string;\n\tpublic parentId: string;\n\tpublic IndexRoute?: boolean;\n\tpublic routers: KRouterTreeItem[] = []\n\tpublic componentRelativePath: string;\n\tpublic uiNode?: boolean\n\n\tconstructor(node: KRouter, parentId: string = '') {\n\t\tthis.path = node.path || '';\n\t\tthis.parentId = parentId;\n\t\tthis.componentRelativePath = node.componentRelativePath;\n\t\tthis.id = (parentId ? parentId + '/' : '') + this.path;\n\t\tthis.uiNode = node.uiNode;\n\t\tthis._addToTree(this, node.routers)\n\t\tconst absPath = getFileAbsolutePath(node.componentRelativePath)\n\t\tKRouterTreeItem.setRelatedFiles(this.id, [absPath])\n\t\tgetRelatedFiles(this.id, absPath)\n\t}\n\n\tstatic setRelatedFiles(id: string, relatedFiles: string[], parentPath?: string) {\n\t\trelatedFiles.forEach(r => {\n\t\t\tif (!FILE_ROUTERS_MAP.has(r)) {\n\t\t\t\tFILE_ROUTERS_MAP.set(r, [id]);\n\t\t\t} else {\n\t\t\t\tFILE_ROUTERS_MAP.set(r, FILE_ROUTERS_MAP.get(r).concat([id]))\n\t\t\t}\n\t\t\t// 写入文件树依赖\n\t\t\tif (parentPath) {\n\t\t\t\tif (!FILE_TREE_MAP.has(r)) {\n\t\t\t\t\tFILE_TREE_MAP.set(r, [parentPath]);\n\t\t\t\t} else {\n\t\t\t\t\tFILE_TREE_MAP.set(r, FILE_TREE_MAP.get(r).concat([parentPath]))\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tprivate _addToTree(parent: KRouterTreeItem, routers: KRouter[] = []) {\n\t\tlet children: KRouterTreeItem[];\n\t\tif (!parent) {\n\t\t\tchildren = this.routers;\n\t\t} else {\n\t\t\tif (!parent.routers) {\n\t\t\t\tparent.routers = [];\n\t\t\t}\n\t\t\tchildren = parent.routers;\n\t\t}\n\n\t\tif (!parent.routers) {\n\t\t\tparent.routers = []\n\t\t}\n\t\tconst parentId = parent.id;\n\t\trouters.forEach(r => {\n\t\t\tif (r.componentRelativePath) {\n\t\t\t\tconst node = new KRouterTreeItem(r, parentId);\n\t\t\t\tchildren.push(node)\n\t\t\t\tthis._addToTree(node, r.routers)\n\t\t\t}\n\t\t})\n\t}\n}\n\n// , fileTree: any, fileImports: { path: string, imports: string[] }[]\nexport class KRouterTree {\n\n\tpublic items: KRouterTreeItem[] = [];\n\tpublic allRouters: PathComponentPathPair[] = []\n\n\t// private _treeMap: Map<string, KRouterTreeItem> = new Map();\n\n\t// public flatternRouters: \n\tconstructor(routers: KRouter[]) {\n\t\tthis.items = routers.map(r => r.componentRelativePath && new KRouterTreeItem(r))\n\t\tthis._setFlatternRouters(routers, '')\n\t\tthis.allRouters = this.getFlatternRouters()\n\t}\n\n\tpublic queryFileAppUrl(absPath: string) {\n\t\tlet queryPath = absPath;\n\t\tif (!FILE_ROUTERS_MAP.has(queryPath)) {\n\t\t\tqueryPath = queryPath.replace(/\\/index\\.(j|t)sx?$/g, '')\n\t\t}\n\t\tif (!FILE_ROUTERS_MAP.has(queryPath)) {\n\t\t\tqueryPath = queryPath.replace(/(\\.(j|t)sx?)$/g, '')\n\t\t}\n\t\treturn FILE_ROUTERS_MAP.get(queryPath)\n\t}\n\n\tpublic getFileParents(absPath: string) {\n\t\tlet queryPath = absPath;\n\t\tif (!FILE_TREE_MAP.has(queryPath)) {\n\t\t\tqueryPath = queryPath.replace(/\\/index\\.(j|t)sx?$/g, '')\n\t\t}\n\t\tif (!FILE_TREE_MAP.has(queryPath)) {\n\t\t\tqueryPath = queryPath.replace(/(\\.(j|t)sx?)$/g, '')\n\t\t}\n\t\treturn FILE_TREE_MAP.get(queryPath)\n\t}\n\n\tprivate _setFlatternRouters(routers?: KRouter[], parentPath?: string) {\n\t\tif (!routers) return\n\t\trouters.forEach(r => {\n\t\t\tif (r.path) {\n\t\t\t\tlet pathname = parentPath + (r.path.includes('/') ? r.path : `/${r.path}`)\n\t\t\t\tROUTERS_MAP.set(pathname, { path: pathname, componentRelativePath: r.componentRelativePath })\n\t\t\t}\n\t\t\tthis._setFlatternRouters(r.routers, r.path)\n\t\t})\n\t}\n\tpublic getFlatternRouters() {\n\t\tlet result = []\n\t\tROUTERS_MAP.forEach(value => {\n\t\t\tresult.push(value)\n\t\t})\n\t\treturn result\n\t}\n\tpublic queryComponentRelativePathByPath(rpath: string) {\n\t\tconst result = ROUTERS_MAP.get(rpath);\n\t\treturn result && result.componentRelativePath\n\t}\n\n}"],"sourceRoot":""}