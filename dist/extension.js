module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t){e.exports=require("vscode")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),o=n(1),i=n(0),s=n(4);function a(e){if(e)try{i.workspace.openTextDocument(e).then(e=>{i.window.showTextDocument(e)})}catch(t){i.window.showInformationMessage(`无法打开${e}`)}else i.window.showInformationMessage("未找到结果")}t.getFileAbsolutePath=function(e,t=!0){const n=t?o.resolve(o.join(s.ROOT_PATH,e)):e;let i="";if(r.existsSync(n))if(r.statSync(n).isDirectory()){let e=[];r.readdirSync(n).forEach(t=>{t.includes("index")&&(/\.(jsx?|tsx?)$/g.test(t)?i=o.join(n,t):e.push(o.join(n,t)))}),!i&&e.length&&e.forEach(e=>{/\.(s?css|less|sass)$/g.test(e)&&(i=e)})}else i=n;else{const e=o.dirname(n);r.existsSync(e)&&r.readdirSync(e).forEach(t=>{/\.(jsx?|tsx?)$/g.test(t)&&t.includes(o.basename(n))&&(r.statSync(o.join(e,t)).isDirectory()||(i=o.join(e,t)))})}return i},t.GotoTextDocument=a,t.pickFiles2Open=function(e){1===e.length?a(e[0]):e.length>1&&i.window.showQuickPick(e.map(e=>({label:o.relative(s.ROOT_PATH,e),target:e})),{placeHolder:"请选择打开的文件"}).then(e=>{e&&e.target&&a(e.target)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.PROJECT_DIR="/__kReactCodeTree__",t.ROOT_PATH=r.workspace.workspaceFolders[0].uri.path},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1),i=n(0);class s{static getEditorCursorText(e){const t=e.document.getWordRangeAtPosition(e.selection.start);return e.document.getText(t)}static getEditorCursorKReactFlowNode(e){return r(this,void 0,void 0,(function*(){const t=e.document.getWordRangeAtPosition(e.selection.start);if(!t)return;const n=e.document.getText(t);if(n){const r=yield i.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri).then(e=>{if(1===(e=e.filter(e=>e.location.range.contains(t))).length)return e});if(1===r.length)return r[0].location.range.isEqual(t)?{text:"节点描述",symbol:r[0].name,filePattern:o.relative(i.workspace.workspaceFolders[0].uri.path,e.document.uri.path)}:{text:"节点描述",symbol:r[0].name,filePattern:o.relative(i.workspace.workspaceFolders[0].uri.path,e.document.uri.path),textPattern:n}}}))}static dump(e){let t={};return["symbol","text","document","routers","operationKeys","textPattern","filePattern","requirePath"].forEach(n=>{e[n]&&(t[n]=e[n])}),e.children&&!e.requirePath&&(t.children=e.children.map(e=>Object.assign({},s.dump(e)))),t}static elementId(e,t=!1){return`${e.filePattern||""}-${e.symbol||""}-${e.textPattern||""}-${e.text||""}-${t?Math.random().toFixed(6):""}`}static isElementEqual(e,t){return s.elementId(e)===s.elementId(t)}static findNodeLine(e,t){const n=new Array(t.lineCount-1).fill(null).map((e,n)=>({text:t.lineAt(n+1).text.replace(/\"\'/g,""),line:n+1})),r=["filePattern","text","symbol","document"].filter(t=>e[t]);let o=null,i=n;return r.every(t=>{const r=n.filter(n=>!!(n.text&&n.text.indexOf(e[t].replace(/\"\'/g,""))>0));return 1===r.length?(o=r[0].line,!1):(i.length>r.length&&(i=r),null===o)}),null===o&&i.length&&i.length!==n.length?i[0].line:o}}t.default=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=n(7),s=n(10),a=n(13);t.activate=function(e){e.subscriptions.push(o.commands.registerCommand("extension.addOpenAsideToContextMenu",()=>r(this,void 0,void 0,(function*(){yield o.commands.executeCommand("editor.action.revealDefinitionAside",{openToSide:!0})})))),new s.default(e),new i.default(e),new a.default(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(8),i=n(3);t.default=class{constructor(e){this.init()}init(){r.commands.registerCommand("extension.selectBracket",()=>{o.selectText(!1)}),r.commands.registerCommand("kReactCodeTree.gotoRelative",()=>{const e=o.selectText(!1),t=i.getFileAbsolutePath(e);i.GotoTextDocument(t)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(9);class i{constructor(e,t){this.bracket=e,this.offset=t}}function s(e,t){const n=[];for(let r=t;r>=0;r--){let t=e.charAt(r);if(o.bracketUtil.isQuoteBracket(t)&&0==n.length)return new i(t,r);if(o.bracketUtil.isOpenBracket(t)){if(0==n.length)return new i(t,r);{let e=n.pop();if(!o.bracketUtil.isMatch(t,e))throw"Unmatched bracket pair"}}else o.bracketUtil.isCloseBracket(t)&&n.push(t)}return null}function a(e,t){const n=[];for(let r=t;r<e.length;r++){let t=e.charAt(r);if(o.bracketUtil.isQuoteBracket(t)&&0==n.length)return new i(t,r);if(o.bracketUtil.isCloseBracket(t)){if(0==n.length)return new i(t,r);{let e=n.pop();if(!o.bracketUtil.isMatch(e,t))throw"Unmatched bracket pair"}}else o.bracketUtil.isOpenBracket(t)&&n.push(t)}return null}function c(e,t){return null!=e&&null!=t&&o.bracketUtil.isMatch(e.bracket,t.bracket)}t.selectText=function(e){const t=function(){const e=r.window.activeTextEditor,t=e.selection;let n=e.document.offsetAt(e.selection.anchor),o=e.document.offsetAt(e.selection.active);return t.isReversed&&([n,o]=[o,n]),{backwardStarter:n-1,forwardStarter:o,text:e.document.getText()}}();let n,i,{text:l,backwardStarter:u,forwardStarter:d}=t;if(u<0||d>=l.length)return;for(var h,f=s(t.text,t.backwardStarter),p=a(t.text,t.forwardStarter);null!=p&&!c(f,p)&&o.bracketUtil.isQuoteBracket(p.bracket);)p=a(t.text,p.offset+1);for(;null!=f&&!c(f,p)&&o.bracketUtil.isQuoteBracket(f.bracket);)f=s(t.text,f.offset-1);if(!c(f,p))return h="Unmatched bracket pair",void r.window.showInformationMessage(h);u==f.offset&&p.offset==d?(n=u-1,i=d+1):e?(n=f.offset-1,i=p.offset+1):(n=f.offset,i=p.offset),function(e,t){const n=r.window.activeTextEditor;n.selection=new r.Selection(n.document.positionAt(e+1),n.document.positionAt(t))}(n,i);const m=r.window.activeTextEditor;return m.document.getText(new r.Range(m.document.positionAt(n+1),m.document.positionAt(i)))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t=["(","{","["],n=[")","}","]"],r=['"',"'"];function o(e){return r.indexOf(e)>=0}e.isMatch=function(e,r){let i=t.indexOf(e);return i>=0?n[i]==r:!!o(e)&&e==r},e.isOpenBracket=function(e){return t.indexOf(e)>=0},e.isCloseBracket=function(e){return n.indexOf(e)>=0},e.isQuoteBracket=o}(t.bracketUtil||(t.bracketUtil={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),i=n(0),s=n(5),a=n(11);t.default=class{constructor(e){this.init(e)}init(e){const t=new a.NodeFlowsView;i.commands.registerCommand("kReactCodeTree.refresh",()=>{i.window.showInformationMessage("kReactCodeTree called refresh."),t.reset()}),e.subscriptions.push(i.commands.registerCommand("extension.getKReactNodeCode",()=>r(this,void 0,void 0,(function*(){const e=i.window.activeTextEditor,t=yield s.default.getEditorCursorKReactFlowNode(e);t?(i.env.clipboard.writeText(JSON.stringify(Object.assign(Object.assign({},t),{filePattern:t.filePattern}),null,2)),i.window.showInformationMessage("Successfully wrote into clipboard.")):i.window.showErrorMessage("Get KReact Node Code failed")})))),e.subscriptions.push(i.commands.registerCommand("kReactCodeTree.editNode",e=>r(this,void 0,void 0,(function*(){if(!e)return;const n=t.treeDataProvider.topRequirePath(e);i.workspace.openTextDocument(n.requirePath).then(t=>{i.window.showTextDocument(t).then(n=>{const r=s.default.findNodeLine(e,t);if(null!==r){var o=new i.Selection(new i.Position(r,0),new i.Position(r,0));n.selection=o,n.revealRange(new i.Range(o.anchor,o.active))}})})})))),e.subscriptions.push(i.commands.registerCommand("kReactCodeTree.insertIn",e=>r(this,void 0,void 0,(function*(){const n=i.window.activeTextEditor,r=yield s.default.getEditorCursorKReactFlowNode(n);if(!e)return;if(!r)return void i.window.showInformationMessage("当前光标位置无效，请在文档中选择一个位置");e.children||(e.children=[]),e.children.push(r);const a=t.treeDataProvider.topRequirePath(e);try{let e=`\nmodule.exports = ${JSON.stringify(a.nodes.map(e=>s.default.dump(e)),null,2)}`;o.writeFile(a.requirePath,e,()=>{t.refresh(),i.window.showInformationMessage("更新成功")})}catch(e){console.log(e,"errrrr")}})))),e.subscriptions.push(i.commands.registerCommand("kReactCodeTree.insertAfter",e=>r(this,void 0,void 0,(function*(){const n=i.window.activeTextEditor,r=yield s.default.getEditorCursorKReactFlowNode(n);if(!e)return;if(!r)return void i.window.showInformationMessage("当前光标位置无效，请在文档中选择一个位置");t.treeDataProvider.addChild(r,e);const a=t.treeDataProvider.topRequirePath(e);try{let e=`\nmodule.exports = ${JSON.stringify(a.nodes.map(e=>s.default.dump(e)),null,2)}`;o.writeFile(a.requirePath,e,()=>{t.refresh(),i.window.showInformationMessage("更新成功")})}catch(e){console.log(e,"errrrr")}}))))}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),i=n(1),s=n(0),a=n(5),c=n(12),l=n(4),u=i.join(l.ROOT_PATH,l.PROJECT_DIR,"/workflows/index.js");function d(e,t,n,r,o,i){return new Promise(a=>{function c(r){return new Promise(i=>{let s=function(t){return e.filePattern&&t.filter(t=>t.location.uri.path.includes(e.filePattern))||t}(r).filter(e=>{return e.name.replace(/\(|\)|\{|\}|\[|\]/g,"")===t[n]});t[n+1]?d(e,t,n+1,s,o).then(e=>i(e)):(o=o.concat(s),i(o))})}if(0!==n){const e={};return r.forEach(t=>{if(t.name){const n=t.name.replace(/\(|\)|\{|\}|\[|\]/g,"");e[n]=!0}}),void r.forEach(()=>{s.commands.executeCommand("vscode.executeWorkspaceSymbolProvider",t[n]).then(t=>{c(t.filter(t=>e[t.containerName])).then(e=>a(e))})})}s.commands.executeCommand("vscode.executeWorkspaceSymbolProvider",t[n]).then(e=>{i&&(e=e.filter(e=>e.location.uri.path===i.uri.path)),c(e).then(e=>a(e))})})}function h(e,t){return new Promise(n=>{if(e.symbol){if(e.symbol){const o=e.symbol.split(".");d(e,o,0,[],[],t).then(t=>{if(e.textPattern){const n=e.textPattern.split("#")[0],o=e.textPattern.split("#")[1],i=void 0!==o?parseInt(o):1;t=t.filter(e=>r(this,void 0,void 0,(function*(){const t=yield s.workspace.openTextDocument(e.location.uri),r=e.location.range.start.line,o=e.location.range.end.line;let a=1;for(let c=r;c<=o;c++){const r=t.lineAt(c).text,o=r.indexOf(n);if(o>=0){if(a===i)return e.location.range=e.location.range.with(new s.Position(c,o),new s.Position(c,o+r.length)),!0;a++}}return!1})))}n(t)})}}else n([])})}t.NodeFlowsView=class{constructor(){this._initNodeFlowsView()}_initNodeFlowsView(){return r(this,void 0,void 0,(function*(){if(o.existsSync(u)){const e=require(`${u}`);this._treeDataProvider=new f(e),delete require.cache[require.resolve(`${u}`)],this._view=s.window.createTreeView("kReactCodeTree",{treeDataProvider:this._treeDataProvider,showCollapseAll:!0}),this._view.onDidChangeSelection(e=>{e.selection.forEach(e=>{e.children&&e.children.length||(console.log(e,"onDidChangeSelection selection"),e.location?this._showlocatedDoc(e.location):e.filePattern?s.workspace.findFiles(e.filePattern).then(t=>{if(console.log(t,"findFiles"),t.length>1)s.window.showInformationMessage("filePattern对应了多个文件，请确定唯一性");else if(t.length){const n=t[0];s.workspace.openTextDocument(n).then(t=>{h(e,t).then(n=>{n.length?this._showMatchedSymbols(e,n,l.ROOT_PATH):s.window.showTextDocument(t)})})}else s.window.showErrorMessage(`未找到filePattern对应文件 ${e.filePattern}`),h(e).then(t=>{this._showMatchedSymbols(e,t,l.ROOT_PATH)})}):h(e).then(t=>{this._showMatchedSymbols(e,t,l.ROOT_PATH)}))})})}else s.window.showWarningMessage(`plz add ${u}`)}))}get treeDataProvider(){return this._treeDataProvider}refresh(){this._treeDataProvider.refresh()}reset(){this._initNodeFlowsView()}_showlocatedDoc(e){s.workspace.openTextDocument(e.uri).then(t=>{s.window.showTextDocument(t).then(t=>{t.revealRange(e.range);var n=new s.Selection(e.range.start,e.range.end);t.selection=n})})}_showMatchedSymbols(e,t,n){e.children||(e.children=[]),t.forEach(t=>{e.children.push({text:`${t.name} - ${i.relative(n,t.location.uri.path)}`,location:t.location,parent:e,iconType:c.KC_NODE_ICON_TYPE.result})}),this._treeDataProvider.refresh(),this._view.reveal(e.children[0],{select:!1,expand:!0,focus:!0}),1===t.length&&this._showlocatedDoc(t[0].location)}};class f{constructor(e){this._onDidChangeTreeData=new s.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,e.forEach(e=>{this._initTree(e)}),this._tree=e}_initTree(e){if(e.iconType||(e.children&&e.children.length?e.iconType=c.KC_NODE_ICON_TYPE.node:e.symbol?e.iconType=c.KC_NODE_ICON_TYPE.node:e.filePattern?e.iconType=c.KC_NODE_ICON_TYPE.file:e.iconType=c.KC_NODE_ICON_TYPE.text),e.requirePath){const t=i.join(l.ROOT_PATH,l.PROJECT_DIR,"/workflows",e.requirePath);try{e.children=require(`${t}`),delete require.cache[require.resolve(`${t}`)]}catch(e){s.window.showErrorMessage(`${t}有误`)}}e.children&&e.children.length&&e.children.forEach(t=>{t.parent=e,this._initTree(t)})}addChild(e,t){let n=this._tree;t.parent&&(t.parent.children||(t.parent.children=[]),n=t.parent.children);const r=n.findIndex(e=>a.default.isElementEqual(e,t));r>=0?n.splice(r+1,0,e):n.push(e)}topRequirePath(e){let t=e;if(!e.parent)return{nodes:this._tree,requirePath:u};for(;t.parent&&!t.requirePath;)t=t.parent;return!t.parent&&t.requirePath?{nodes:t.children,requirePath:t.requirePath}:{nodes:this._tree,requirePath:u}}getChildren(e){return e?e.children||[]:this._tree}getTreeItem(e){return Object.assign(Object.assign({label:e.text},this._getIconPath(e.children&&e.children.length?c.KC_NODE_ICON_TYPE.node:e.iconType)),{collapsibleState:e.children&&e.children.length?s.TreeItemCollapsibleState.Collapsed:s.TreeItemCollapsibleState.None})}getParent(e){return e.parent}refresh(){this._onDidChangeTreeData.fire()}_getIconPath(e){switch(e){default:return{};case c.KC_NODE_ICON_TYPE.node:return{iconPath:{light:`${i.join(__filename,"..","..","resources","light","node.svg")}`,dark:`${i.join(__filename,"..","..","resources","dark","node.svg")}`}};case c.KC_NODE_ICON_TYPE.text:return{iconPath:{light:`${i.join(__filename,"..","..","resources","light","text.svg")}`,dark:`${i.join(__filename,"..","..","resources","dark","text.svg")}`}};case c.KC_NODE_ICON_TYPE.result:return{iconPath:{light:i.join(__filename,"..","..","resources","light","gou.svg"),dark:i.join(__filename,"..","..","resources","dark","gou.svg")}};case c.KC_NODE_ICON_TYPE.file:return{iconPath:{light:i.join(__filename,"..","..","resources","light","document.svg"),dark:i.join(__filename,"..","..","resources","dark","document.svg")}}}}}t.KReactCodeTree=f;class p extends s.TreeItem{constructor(e,t,n,r){super(e,n),this.label=e,this.version=t,this.collapsibleState=n,this.command=r,this.iconPath={light:i.join(__filename,"..","..","resources","light","dependency.svg"),dark:i.join(__filename,"..","..","resources","dark","dependency.svg")},this.contextValue="dependency"}get tooltip(){return`${this.label}-${this.version}`}get description(){return this.version}}t.KReactCodeTreeItem=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.text="text",e.node="node",e.result="result",e.file="file"}(t.KC_NODE_ICON_TYPE||(t.KC_NODE_ICON_TYPE={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),i=n(1),s=n(0),a=n(4),c=n(14),l=n(3);t.default=class{constructor(e){this.init(e)}loadRouters(){const e=i.join(a.ROOT_PATH,a.PROJECT_DIR,"/router_config.js");if(o.existsSync(e))return require(`${e}`);s.window.showErrorMessage("未找到路由配置文件")}init(e){this.kRouterTree=new c.KRouterTree(this.loadRouters()),e.subscriptions.push(s.commands.registerCommand("extension.goFileParentFile",e=>{const t=this.kRouterTree.getFileParents(e.fsPath);l.pickFiles2Open(t)})),e.subscriptions.push(s.commands.registerCommand("extension.goFileTopParentFile",e=>{let t=this.recursiveGetParents(e.fsPath,[],new Map);l.pickFiles2Open(t)})),e.subscriptions.push(s.commands.registerCommand("extension.getFileAppUrl",e=>{const t=this.kRouterTree.queryFileAppUrl(e.fsPath);t?(s.env.clipboard.writeText(t.map(e=>"https://localhost:3000"+e).join("\n")),s.window.showInformationMessage("复制成功")):s.window.showInformationMessage("暂无结果")})),e.subscriptions.push(s.commands.registerCommand("kReactRouterTree.SearchRouter",()=>r(this,void 0,void 0,(function*(){const e=yield s.window.showQuickPick(this.kRouterTree.allRouters.map(e=>({label:e.path})),{placeHolder:"请输入 pathname"});if(e&&e.label){const t=this.kRouterTree.queryComponentRelativePathByPath(e.label);if(t){const e=l.getFileAbsolutePath(t);l.GotoTextDocument(e)}}}))))}recursiveGetParents(e,t,n){if(n.has(e))return t;n.set(e,!0);let r=this.kRouterTree.getFileParents(e).filter(t=>t!==e);return r&&r.forEach(e=>{const r=this.kRouterTree.getFileParents(e);r&&r.length?this.recursiveGetParents(e,t,n):t.push(e)}),t}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1),i=n(0),s=n(3),a=new Map,c=new Map,l=new Map,u=new Map;class d{constructor(e,t=""){this.routers=[],this.path=e.path||"",this.parentId=t,this.componentRelativePath=e.componentRelativePath,this.id=(t?t+"/":"")+this.path,this.uiNode=e.uiNode,this._addToTree(this,e.routers);const n=s.getFileAbsolutePath(e.componentRelativePath);d.setRelatedFiles(this.id,[n]),function e(t,n){return r(this,void 0,void 0,(function*(){if(!t||!n)return;const r=c.get(n),a=r||[];if(r)d.setRelatedFiles(t,r),r.forEach(n=>{e(t,n)});else try{const r=yield i.workspace.openTextDocument(s.getFileAbsolutePath(n,!1));for(let e=1;e<r.lineCount-1;e++){const t=r.lineAt(e).text;if(/\sfrom\s\'/.test(t)){const e=t.split(" ");if(e[e.length-1]){const t=e[e.length-1].replace("'","").replace('"',"");t&&a.push(t)}}if(/import\(\'/.test(t)){const e=t.split("'");if(e[1]){const t=e[1].replace("'","").replace('"',"");t&&a.push(t)}}if(/function(.+)/.test(t)||/export(.+)/.test(t))break}const u=a.filter(e=>e.includes("/")).map(e=>e.replace(/\'/g,"").replace(/\"/g,"")).map(e=>/^\.+/.test(e)?o.join(o.dirname(n),e):/src\//.test(e)?s.getFileAbsolutePath(e):void 0).filter(e=>!!e);u.forEach(n=>{l.has(n)||e(t,n)}),c.set(n,u),d.setRelatedFiles(t,u,n)}catch(e){}}))}(this.id,n)}static setRelatedFiles(e,t,n){t.forEach(t=>{l.has(t)?l.set(t,l.get(t).concat([e])):l.set(t,[e]),n&&(a.has(t)?a.set(t,a.get(t).concat([n])):a.set(t,[n]))})}_addToTree(e,t=[]){let n;e?(e.routers||(e.routers=[]),n=e.routers):n=this.routers,e.routers||(e.routers=[]);const r=e.id;t.forEach(e=>{if(e.componentRelativePath){const t=new d(e,r);n.push(t),this._addToTree(t,e.routers)}})}}t.KRouterTreeItem=d;t.KRouterTree=class{constructor(e){this.items=[],this.allRouters=[],this.items=e.map(e=>e.componentRelativePath&&new d(e)),this._setFlatternRouters(e,""),this.allRouters=this.getFlatternRouters()}queryFileAppUrl(e){let t=e;return l.has(t)||(t=t.replace(/\/index\.(j|t)sx?$/g,"")),l.has(t)||(t=t.replace(/(\.(j|t)sx?)$/g,"")),l.get(t)}getFileParents(e){let t=e;return a.has(t)||(t=t.replace(/\/index\.(j|t)sx?$/g,"")),a.has(t)||(t=t.replace(/(\.(j|t)sx?)$/g,"")),a.get(t)}_setFlatternRouters(e,t){e&&e.forEach(e=>{if(e.path){let n=t+(e.path.includes("/")?e.path:`/${e.path}`);u.set(n,{path:n,componentRelativePath:e.componentRelativePath})}this._setFlatternRouters(e.routers,e.path)})}getFlatternRouters(){let e=[];return u.forEach(t=>{e.push(t)}),e}queryComponentRelativePathByPath(e){const t=u.get(e);return t&&t.componentRelativePath}}}]);
//# sourceMappingURL=extension.js.map